#!/bin/sh

echo "ğŸ” Running pre-push hook..."

# Check for package.json changes compared to origin/main
files_changed=$(git diff --name-only origin/main...HEAD 2>/dev/null)

if echo "$files_changed" | grep -q "package.json"; then
  echo "ğŸ“¦ Dependencies changed. Running pnpm install..."
  pnpm install
fi

# Run build
echo "ğŸ—ï¸ Running build..."
pnpm run build

if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Push aborted."
  exit 1
fi

# Run type check (optional but recommended)
echo "â¡ï¸ Running type check..."
pnpm run type-check

if [ $? -ne 0 ]; then
  echo "âŒ Type check failed. Push aborted."
  exit 1
fi

echo "âœ… Build and checks passed. Proceeding with push..."
